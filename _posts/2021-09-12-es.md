---
layout: post
title: ESë€? 
categories: DB
tags: [DB, ES]
---

## Elastic Search ë€ ?

### ES

ElastciSearch ëŠ” Lucene ê¸°ë°˜ì˜ Java ì˜¤í”ˆ ì†ŒìŠ¤ ë¶„ì‚° ê²€ìƒ‰ ì—”ì§„

â†’ ìì²´ì ìœ¼ë¡œ ê²€ìƒ‰ ì—”ì§„ì´ë¼ê³  í•˜ê¸´ ì¢€ ê·¸ë ‡ê³  í”„ë¡œê·¸ë¨ìœ¼ë¡œ ê²€ìƒ‰ì—”ì§„ !

â†’ ì‹¤ì§ˆì ìœ¼ë¡œ ì‘ë™í•˜ëŠ” ê²€ìƒ‰ ì—”ì§„ì€ Lucene

ëª¨ë“  ë°ì´í„°ë¥¼ ìƒ‰ì¸í•˜ì—¬ ì €ì¥í•˜ê³  ê²€ìƒ‰, ì§‘ê³„ ë“±ì„ ìˆ˜í–‰í•˜ë©° ê²°ê³¼ë¥¼ í´ë¼ì´ì–¸íŠ¸ ë˜ëŠ” ë‹¤ë¥¸ í”„ë¡œê·¸ë¨ìœ¼ë¡œ ì „ë‹¬í•˜ì—¬ ë™ì‘í•˜ë„ë¡ í•¨

ê²€ìƒ‰ì„ ìœ„í•´ ë‹¨ë…ìœ¼ë¡œ ì‚¬ìš©í•˜ê¸°ë„ í•˜ì§€ë§Œ **ELK ìŠ¤íƒ**ìœ¼ë¡œ ì‚¬ìš©ë˜ê¸°ë„ í•¨



### ELK

- **LogStash** : ë‹¤ì–‘í•œ ì†ŒìŠ¤( DB, csvíŒŒì¼ ë“± )ì˜ ë¡œê·¸ ë˜ëŠ” íŠ¸ëœì­ì…˜ ë°ì´í„°ë¥¼ ìˆ˜ì§‘, ì§‘ê³„, íŒŒì‹±í•˜ì—¬ Elasticsearchë¡œ ì „ë‹¬ â†’ ìˆ˜ì§‘
- **Elasticsearch** : Logstashë¡œë¶€í„° ë°›ì€ ë°ì´í„°ë¥¼ ê²€ìƒ‰ ë° ì§‘ê³„ë¥¼ í•˜ì—¬ í•„ìš”í•œ ê´€ì‹¬ ìˆëŠ” ì •ë³´ë¥¼ íšë“ â†’ ë¶„ì„ , ì €ì¥
- **Kibana** : Elasticsearchì˜ ë¹ ë¥¸ ê²€ìƒ‰ì„ í†µí•´ ë°ì´í„°ë¥¼ ì‹œê°í™” ë° ëª¨ë‹ˆí„°ë§ â†’ ì‹œê°í™”

![img](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=http%3A%2F%2Fcfile5.uf.tistory.com%2Fimage%2F993B7E495C98CAA7064E0B)



### ElasitcSearch vs RDBMS

| RDBMS    | ES       |
| -------- | -------- |
| schema   | mapping  |
| Database | index    |
| table    | type     |
| row      | document |
| Column   | Field    |



### ElasticSearch ì•„í‚¤í…ì³ / ìš©ì–´ ì •ë¦¬

![img](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=http%3A%2F%2Fcfile27.uf.tistory.com%2Fimage%2F99A97A355C98D42D2E5196)

**1) í´ëŸ¬ìŠ¤í„°( cluseter )**

í´ëŸ¬ìŠ¤í„°ë€ Elasticsearchì—ì„œ ê°€ì¥ í° ì‹œìŠ¤í…œ ë‹¨ìœ„ë¥¼ ì˜ë¯¸í•˜ë©°, ìµœì†Œ í•˜ë‚˜ ì´ìƒì˜ ë…¸ë“œë¡œ ì´ë£¨ì–´ì§„ ë…¸ë“œë“¤ì˜ ì§‘í•©

ì„œë¡œ ë‹¤ë¥¸ í´ëŸ¬ìŠ¤í„°ëŠ” ë°ì´í„°ì˜ ì ‘ê·¼, êµí™˜ì„ í•  ìˆ˜ ì—†ëŠ” ë…ë¦½ì ì¸ ì‹œìŠ¤í…œìœ¼ë¡œ ìœ ì§€

ì—¬ëŸ¬ ëŒ€ì˜ ì„œë²„ê°€ í•˜ë‚˜ì˜ í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì„±í•  ìˆ˜ ìˆê³ , í•œ ì„œë²„ì— ì—¬ëŸ¬ ê°œì˜ í´ëŸ¬ìŠ¤í„°ê°€ ì¡´ì¬ í•  ìˆ˜ ìˆìŒ



**2) ë…¸ë“œ( node )**

Elasticsearchë¥¼ êµ¬ì„±í•˜ëŠ” í•˜ë‚˜ì˜ ë‹¨ìœ„ í”„ë¡œì„¸ìŠ¤ë¥¼ ì˜ë¯¸

shard ë¡œ êµ¬ì„±ë¨ 

ê·¸ ì—­í• ì— ë”°ë¼ Master-eligible, Data, Ingest, Tribe ë…¸ë“œë¡œ êµ¬ë¶„



**3) ì¸ë±ìŠ¤( index ) **

Elasticsearchì—ì„œ **index**ëŠ” RDBMSì—ì„œ databaseì™€ ëŒ€ì‘í•˜ëŠ” ê°œë…



**4) ìƒ¤ë“œ( Shard ) / ë³µì œ( Replica )**

**ìƒ¤ë”©( sharding )**ì€ ë°ì´í„°ë¥¼ ë¶„ì‚°í•´ì„œ ì €ì¥í•˜ëŠ” ë°©ë²•ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

ì¦‰, Elasticsearchì—ì„œ ìŠ¤ì¼€ì¼ ì•„ì›ƒì„ ìœ„í•´ indexë¥¼ ì—¬ëŸ¬ shardë¡œ ìª¼ê°  ê²ƒì…ë‹ˆë‹¤.

ê¸°ë³¸ì ìœ¼ë¡œ 1ê°œê°€ ì¡´ì¬í•˜ë©°, ê²€ìƒ‰ ì„±ëŠ¥ í–¥ìƒì„ ìœ„í•´ í´ëŸ¬ìŠ¤í„°ì˜ ìƒ¤ë“œ ê°¯ìˆ˜ë¥¼ ì¡°ì •í•˜ëŠ” íŠœë‹ì„ í•˜ê¸°ë„ í•¨ 



**replica**ëŠ” ë˜ ë‹¤ë¥¸ í˜•íƒœì˜ shardë¼ê³  í•  ìˆ˜ ìˆìŒ 

ë…¸ë“œë¥¼ ì†ì‹¤í–ˆì„ ê²½ìš° ë°ì´í„°ì˜ ì‹ ë¢°ì„±ì„ ìœ„í•´ ìƒ¤ë“œë“¤ì„ ë³µì œí•˜ëŠ” ê²ƒ ë”°ë¼ì„œ replicaëŠ” ì„œë¡œ ë‹¤ë¥¸ ë…¸ë“œì— ì¡´ì¬í•  ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.

![https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=http%3A%2F%2Fcfile29.uf.tistory.com%2Fimage%2F991563425C98CB341A49D4](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=http%3A%2F%2Fcfile29.uf.tistory.com%2Fimage%2F991563425C98CB341A49D4)



=> Cluster ì€ node ë“¤ì˜ ì§‘í•©, node ë“¤ì€ shard ë¡œ êµ¬ì„±, ë°ì´í„°ëŠ” shardë¡œ ë¶„ì‚°ë˜ì–´ ì €ì¥ 



### Elasticsearch íŠ¹ì§•

- **Scale out**

- - ìƒ¤ë“œë¥¼ í†µí•´ ê·œëª¨ê°€ ìˆ˜í‰ì ìœ¼ë¡œ ëŠ˜ì–´ë‚  ìˆ˜ ìˆìŒ

- **ê³ ê°€ìš©ì„±**

- - Replicaë¥¼ í†µí•´ ë°ì´í„°ì˜ ì•ˆì •ì„±ì„ ë³´ì¥

- **Schema Free**

- - Json ë¬¸ì„œë¥¼ í†µí•´ ë°ì´í„° ê²€ìƒ‰ì„ ìˆ˜í–‰í•˜ë¯€ë¡œ ìŠ¤í‚¤ë§ˆ ê°œë…ì´ ì—†ìŒ

- **Restful**



### ì—­ìƒ‰ì¸(inverted index)

ì±…ì—ì„œ ë§¨ ì•ì— ë³¼ ìˆ˜ ìˆëŠ” ëª©ì°¨ê°€ index

ì±… ë§¨ë’¤ì— í‚¤ì›Œë“œë§ˆë‹¤ ì°¾ì•„ë³´ê¸°ê°€ inverted index

**RDBMS**

| ID   | Text         |
| ---- | ------------ |
| 1    | I have a pen |
| 2    | I am pen     |



**ES**

| Term | ID   |
| ---- | ---- |
| I    | 1,2  |
| have | 1    |
| am   | 2    |
| a    | 1    |
| pen  | 1,2  |



## Query DSL

### Query Context vs Filter Context

**Query**

: ì´ ë¬¸ì„œê°€ ì´ ì¿¼ë¦¬ì ˆê³¼ ì–¼ë§ˆë‚˜ ì˜ ì¼ì¹˜í•©ë‹ˆê¹Œ ? ë¼ëŠ” ì§ˆë¬¸ì— ëŒ€ë‹µ

: ì–¼ë§ˆë‚˜ ì˜ ì¼ì¹˜í•˜ëŠ” ì§€ë¥¼ _score ë¡œ í‘œí˜„ 



**Filter**

: ì´ ë¬¸ì„œê°€ ì´ ì¿¼ë¦¬ì ˆê³¼ ì¼ì¹˜í•©ë‹ˆê¹Œ? ë¼ëŠ” ì§ˆë¬¸ì— ëŒ€ë‹µ 

: score ì„ ê³„ì‚°í•˜ì§€ ì•Šê³  ê°„ë‹¨í•˜ê²Œ true/false ë¡œ ë¦¬í„´ 

: ìë™ìœ¼ë¡œ ìºì‹±ë˜ì–´ ì„±ëŠ¥ì„ ë†’ì„ 





### í’€ í…ìŠ¤íŠ¸ ì¿¼ë¦¬ 

**match_all**

: ë³„ë‹¤ë¥¸ ì¡°ê±´ ì—†ì´ í•´ë‹¹ ì¸ë±ìŠ¤ì˜ ëª¨ë“  ë„íë¨¼íŠ¸ë¥¼ ê²€ìƒ‰í•˜ëŠ” ì¿¼ë¦¬

```
GET indexëª…/_search
{
  "query":{
    "match_all":{ }
  }
}
```



**match**

: í’€ í…ìŠ¤íŠ¸ ê²€ìƒ‰ì— ì‚¬ìš©ë˜ëŠ” ê°€ì¥ ì¼ë°˜ì ì¸ ì¿¼ë¦¬

: ì—¬ëŸ¬ ê°œì˜ ê²€ìƒ‰ì–´ë¥¼ ì§‘ì–´ë„£ê²Œ ë˜ë©´ ë””í´íŠ¸ë¡œ **OR** ì¡°ê±´ìœ¼ë¡œ ê²€ìƒ‰

:  ê²€ìƒ‰ì–´ê°€ ì—¬ëŸ¿ì¼ ë•Œ ê²€ìƒ‰ ì¡°ê±´ì„ **OR** ê°€ ì•„ë‹Œ **AND** ë¡œ ë°”ê¾¸ë ¤ë©´ `operator` ì˜µì…˜ì„ ì‚¬ìš©

```
GET indexëª…/_search
{
  "query": {
    "match": {
      "message": {
        "query": "quick dog",
        "operator": "and"
      }
    }
  }
}
```



**match_phrase**

: ê³µë°±ì„ í¬í•¨í•´ ì •í™•íˆ ì¼ì¹˜í•˜ëŠ” ë‚´ìš©ì„ ê²€ìƒ‰

```
GET indexëª…/_search
{
  "query": {
    "match_phrase": {
      "message": "lazy dog"
    }
  }
}
```



**term**

: ìƒ‰ì¸ì´ ë‚˜ëˆ ì§€ë©´ì„œ í˜•íƒœì†Œë¡œ ë‚˜ëˆ ì§€ëŠ” í† í°ë“±ì„ term ì´ë¼ê³  í•¨ 

: ì£¼ì–´ì§„ ë‚´ìš©ê³¼ ì •í™•íˆ ì¼ì¹˜í•˜ëŠ” ë‚´ìš©ì„ ê²€ìƒ‰ 

```
GET indexëª…/_search
{
  "query": {
    "term": {
      "message": "lazy dog"
    }
  }
}
```



**terms**

: ì—¬ëŸ¬ê°œ í† í°ì„ ê²€ìƒ‰í•  ìˆ˜ ìˆìŒ 

```
GET indexëª…/_search
{
  "query": {
    "term": {
      "message": ["lazy", "dog"]
    }
  }
}
```



**match vs term**

ì—¬ëŸ¬ ê°œì˜ ë¬¼ê±´ë“¤ - (í˜•íƒœì†Œ ë¶„ì„ê¸°) -> ì—¬ëŸ¬ / ê°œ / ë¬¼ê±´ / ë¬¼ê±´ë“¤

term : í˜•íƒœì†Œ ë¶„ì„ì— ì˜í•´ ìª¼ê°œì§„ í† í°ì„ ê¸°ë°˜ìœ¼ë¡œ ì‘ë™ 

EX ) ì—¬ëŸ¬ -> ê²€ìƒ‰ O , ì—¬ëŸ¬ê°œ -> ê²€ìƒ‰ X



match : í˜•íƒœì†Œ ë¶„ì„ì— ì˜í•´ ìª¼ê°œì§„ í† í°ë“¤ì„ ê¸°ë°˜ìœ¼ë¡œ ì‘ë™í•˜ì§€ë§Œ ì£¼ì–´ì§„ ì§ˆì˜ë¡œ í˜•íƒœì†Œ ë¶„ê¸°ë¥¼ ê±°ì³ ìª¼ê°  ë‹¤ìŒ ì¡°íšŒ 

EX ) ì—¬ëŸ¬ê°œ -> ì—¬ëŸ¬ / ê°œ -> or ë¡œ ì¡°íšŒ -> ê²€ìƒ‰ O 



### Bool ë³µí•© ì¿¼ë¦¬

: bool(true/false) ë¡œì§ì„ ì‚¬ìš©í•˜ëŠ” ì¿¼ë¦¬ 

```
GET indexëª…/_search
{
  "query": {
    "bool": {
      "must": [
        { <ì¿¼ë¦¬> }, â€¦
      ],
      "must_not": [
        { <ì¿¼ë¦¬> }, â€¦
      ],
      "should": [
        { <ì¿¼ë¦¬> }, â€¦
      ],
      "filter": [
        { <ì¿¼ë¦¬> }, â€¦
      ]
    }
  }
}
```

**must** 

: ì¿¼ë¦¬ê°€ ì°¸ì¸ ë„íë¨¼íŠ¸ë“¤ì„ ê²€ìƒ‰

**must_not** 

: ì¿¼ë¦¬ê°€ ê±°ì§“ì¸ ë„íë¨¼íŠ¸ë“¤ì„ ê²€ìƒ‰

**should** 

: ê²€ìƒ‰ ê²°ê³¼ ì¤‘ ì´ ì¿¼ë¦¬ì— í•´ë‹¹í•˜ëŠ” ë„íë¨¼íŠ¸ì˜ ì ìˆ˜ë¥¼ ë†’ì„

**filter** 

: ì¿¼ë¦¬ê°€ ì°¸ì¸ ë„íë¨¼íŠ¸ë¥¼ ê²€ìƒ‰í•˜ì§€ë§Œ ìŠ¤ì½”ì–´ë¥¼ ê³„ì‚°í•˜ì§€ ì•ŠìŒ 

: must ë³´ë‹¤ ê²€ìƒ‰ ì†ë„ê°€ ë¹ ë¥´ê³  ìºì‹±ì´ ê°€ëŠ¥



## ë ˆí¼ëŸ°ìŠ¤

[ğŸ™ˆ[Elasticsearch] ê¸°ë³¸ ê°œë…ì¡ê¸°ğŸµ](https://victorydntmd.tistory.com/308?category=742451)

[6.1 ì—­ ì¸ë±ìŠ¤ - Inverted Index](https://esbook.kimjmin.net/06-text-analysis/6.1-indexing-data)

[Elasticsearch ì§ˆì˜ DSL ì •ë¦¬](https://wedul.site/493)

ğŸ™ˆ[Elasticsearch\] ì…ë¬¸í•˜ê¸°(4) - ë‹¤ì–‘í•œ ê²€ìƒ‰ ë°©ë²• ( Query DSL )ğŸµ](https://victorydntmd.tistory.com/314)

[[Elasticsearch] DSL ì‚´í´ë³´ê¸°](https://brownbears.tistory.com/462)

