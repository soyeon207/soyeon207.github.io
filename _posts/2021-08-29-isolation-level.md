---
layout: post
title: íŠ¸ëœì­ì…˜ ê²©ë¦¬ ìˆ˜ì¤€ (isolation Level)
categories: DB
tags: [DB]
---

## íŠ¸ëœì­ì…˜ ê²©ë¦¬ ìˆ˜ì¤€ (isolation Level)
> ë™ì‹œì— ì—¬ëŸ¬ íŠ¸ëœì­ì…˜ì´ ì‹¤í–‰ëœ ê²½ìš° ì–´ë–»ê²Œ ë™ì‘í• ì§€ë¥¼ ëª…ì‹œ

- Dirty Read (ë¹„ì»¤ë°‹ ì½ê¸°)

  : íŠ¸ëœì­ì…˜ì—ì„œ ì»¤ë°‹ë˜ê¸° ì „ ì‘ì—… ë‚´ìš©ì„ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì—ì„œ ë³¼ ìˆ˜ ìˆìŒ 

  EX) A ë¼ëŠ” íŠ¸ëœì­ì…˜ì—ì„œ id : 22, name: ì´ë¦„ì„ insert í•˜ê³  ì»¤ë°‹í•˜ì§€ ì•Šì€ ìƒíƒœì—ì„œ B ë¼ëŠ” íŠ¸ëœì­ì…˜ì´ id: 22 ë¥¼ select í•˜ëŠ” ê²½ìš° ì½ì„ ìˆ˜ ìˆìŒ. ì´ë•Œ A íŠ¸ëœì­ì…˜ì—ì„œ ì»¤ë°‹ë˜ì§€ ì•Šê³  ë¡¤ë°±ë˜ëŠ” ê²½ìš° ë°ì´í„° ì •í•©ì„±ì— ë¬¸ì œê°€ ìƒê¹€ 

  ğŸ‘‰ **ê°€ëŠ¥í•œ ì´ìœ **ğŸ‘ˆ

  InnoDB ì—”ì§„ì´ transaction ì„ ì»¤ë°‹í•˜ëŠ” ë°©ì‹ ë•Œë¬¸ì— ê°€ëŠ¥. InnonDB ëŠ” ì¼ë‹¨ commit ì´ ë˜ì§€ ì•Šë”ë¼ë„ ì‹¤í–‰í•œ ëª¨ë“  ì¿¼ë¦¬ë¥¼ DB ì— ì ìš©. ì¦‰, íŠ¹ë³„íˆ logë¥¼ ë³´ê³  íŠ¹ì • ì‹œì ì˜ snapshotì„ ë³µêµ¬í•˜ëŠ” **consistent read**ë¥¼ í•˜ì§€ ì•Šê³  ê·¸ëƒ¥ í•´ë‹¹ ì‹œì ì˜ DB ë¥¼ ì½ìœ¼ë©´ dirty read 

  ğŸŒŸ **consistent read(ì¼ê´€ì  ì½ê¸°)**

  : select ì‹œ í˜„ì¬ DB ê°’ì´ ì•„ë‹Œ íŠ¹ì • ì‹œì ì˜ DB snapshot ì„ ì½ì–´ ì˜¤ëŠ” ê²ƒ 

  : ì´ snapshot ì€ commit ëœ ë³€í™”ë§Œì´ ì €ì¥ëœ ê²ƒì„ ì˜ë¯¸ 

  : InnoDB ì—”ì§„ì€ ê° ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•  ë•Œë§ˆë‹¤ ì‹¤í–‰í•œ ì¿¼ë¦¬ì˜ logë¥¼ ì°¨ê³¡ì°¨ê³¡ ì €ì¥í•œë‹¤. ê·¸ë¦¬ê³  ë‚˜ì¤‘ì— consistent readë¥¼ í•  ë•Œ ì´ logë¥¼ í†µí•´ íŠ¹ì • ì‹œì ì˜ DB snapshotì„ ë³µêµ¬í•˜ì—¬ ê°€ì ¸ì˜¨ë‹¤.

  
- Non-Repeatable Read (ë¹„ë°˜ë³µ ì½ê¸°)

  : í•œ íŠ¸ëœì­ì…˜ì—ì„œ ê°™ì€ ì¿¼ë¦¬ë¥¼ ë‘ë²ˆ ì‹¤í–‰ì‹œ ê·¸ ì‚¬ì´ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì´ ê°’ì„ ìˆ˜ì •, ì‚­ì œ í•´ì„œ ë‘ ì¿¼ë¦¬ì˜ ê²°ê³¼ê°€ ìƒì´í•˜ê²Œ ë‚˜íƒ€ë‚¨ 

- Phantom Read (ê°€ìƒ ì½ê¸°)

  : í•œ íŠ¸ëœì­ì…˜ ì•ˆì—ì„œ ì¼ì • ë²”ìœ„ì˜ ë ˆì½”ë“œë¥¼ ë‘ë²ˆ ì´ìƒ ì½ì„ ë•Œ, ì²«ë²ˆì§¸ ì¿¼ë¦¬ì—ì„œ ì—†ë˜ ë ˆì½”ë“œê°€ ë‘ë²ˆì§¸ ì¿¼ë¦¬ì—ì„œ ë‚˜íƒ€ë‚˜ëŠ” í˜„ìƒ


ê²©ë¦¬ ìˆ˜ì¤€ì€ í•´ë‹¹ ë¬¸ì œê°€ ë°œìƒí•˜ëŠ”ì§€ì— ë”°ë¼ ë¶„ë¥˜

| ë¶„ë¦¬ ë ˆë²¨        | Dirty Read | Non-Repeatable Read | Phantom Read |
| ---------------- | ---------- | ------------------- | ------------ |
| READ UNCOMMITEED | ë°œìƒ       | ë°œìƒ                | ë°œìƒ         |
| READ COMMITTED   | -          | ë°œìƒ                | ë°œìƒ         |
| REPEATABLE READ  | -          | -                   | ë°œìƒ         |
| SERIALIZABLE     | -          | -                   | -            |

1. READ UNCOMMITTED
   - **SELECT ì¿¼ë¦¬ë¥¼ ì‹¤í–‰ í•  ë•Œ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì—ì„œ ì»¤ë°‹ë˜ì§€ ì•Šì€ ë°ì´í„°ë¥¼ ì½ì„ ìˆ˜ ìˆìŒ**
   - Dirty Read, Non-Repeatable Read, Phantom Read ë°œìƒ
   - ì˜¤ë¼í´ì€ ì´ ë ˆë²¨ ì§€ì› X

2. READ COMMITTED
   - **ì»¤ë°‹ ì™„ë£Œëœ ë°ì´í„°ë§Œ ì½ì„ ìˆ˜ ìˆëŠ” ê²©ë¦¬ìˆ˜ì¤€**
   - Non-Repeatable Read, Phantom Read ë°œìƒ
   - DB2, SQL Server, Sybaseì˜ ê²½ìš° Shared Lockì„ ì´ìš©í•´ì„œ êµ¬í˜„, í•˜ë‚˜ì˜ ë ˆì½”ë“œë¥¼ ì½ì„ ë•Œ Lockì„ ì„¤ì •í•˜ê³  í•´ë‹¹ ë ˆì½”ë“œì—ì„œ ë¹ ì§€ëŠ” ìˆœê°„ Lockí•´ì œ => Select ë¬¸ìœ¼ë¡œ ì½ì„ ë•Œë§Œ í•´ë‹¹ Row ì— ëŒ€í•´ S Lock ì´ ê±¸ë¦¼ 
   - Oracleì€ Lockì„ ì‚¬ìš©í•˜ì§€ ì•Šê³  ì¿¼ë¦¬ì‹œì‘ ì‹œì ì˜ Undo ë°ì´í„°ë¥¼ ì œê³µí•˜ëŠ” ë°©ì‹ìœ¼ë¡œ êµ¬í˜„
   - ë§¤ë²ˆ read ë§ˆë‹¤ consistent read(ì¼ê´€ì  ì½ê¸°)ë¥¼ í†µí•œ ìƒˆë¡œìš´ snapshot ì„ ìƒì„±
     â¡ï¸ Non-Repeatable Read, Phantom Read ë°œìƒ 
   - Record lock ë§Œ ì‚¬ìš©í•˜ê³  Gap lock ì‚¬ìš© X

3. REPEATABLE READ
   - **í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ì—ì„œ ë°˜ë³µë˜ëŠ” SELECT ëŠ” í•­ìƒ ê°™ì€ ê°’ì„ ì¡°íšŒ**
   - ì²˜ìŒ read í•œ ì‹œê°„ì„ ê¸°ë¡í•˜ê³  ê·¸ ì´í›„ ëª¨ë“  select ë§ˆë‹¤ ì²˜ìŒ ì‹œì ì„ ê¸°ì¤€ìœ¼ë¡œ consistent read ìˆ˜í–‰ 
     â¡ï¸ Non-Repeatable Read ë°œìƒ X 
   - íŠ¸ëœì­ì…˜ì´ ì™„ë£Œ ë  ë•Œê¹Œì§€ í•´ë‹¹ ë°ì´í„°ì— ëŒ€í•œ ê°±ì‹ , ì‚­ì œê°€ ë¶ˆê°€ëŠ¥ (í•´ë‹¹ row ì— Shared Lock ì´ ê±¸ë¦¼)
   - InnoDB ì—”ì§„ì—ì„œ ì‚¬ìš©í•˜ëŠ” ê¸°ë³¸ ê²©ë¦¬ ìˆ˜ì¤€
   - DB2, SQL Serverì˜ ê²½ìš° íŠ¸ëœì­ì…˜ ê³ ë¦½í™” ìˆ˜ì¤€ì„ Repeatable Readë¡œ ë³€ê²½í•˜ë©´ ì½ì€ ë°ì´í„°ì— ê±¸ë¦° ê³µìœ  Lockì„ ì»¤ë°‹í•  ë•Œê¹Œì§€ ìœ ì§€í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ êµ¬í˜„ => íŠ¸ëœì­ì…˜ì´ ì»¤ë°‹ ë  ë•Œê¹Œì§€ Select ë¬¸ìœ¼ë¡œ ì½ì€ Row ì— S Lock ì´ ê±¸ë¦¼
   - Oracleì€ ì´ ë ˆë²¨ì„ ëª…ì‹œì ìœ¼ë¡œ ì§€ì›í•˜ì§€ ì•Šì§€ë§Œ for updateì ˆì„ ì´ìš©í•´ êµ¬í˜„ ê°€ëŠ¥,

4. SERIALIZABLE
   - **íŠ¸ëœì­ì…˜ì´ ì™„ë£Œ ë  ë•Œê¹Œì§€ ê·¸ ì˜ì—­ì— í•´ë‹¹í•˜ëŠ” ë°ì´í„° ìˆ˜ì •(UPDATE) ë° ì…ë ¥(INSERT) ë¶ˆê°€ëŠ¥** 
   - ê¸°ë³¸ì ìœ¼ë¡œ REPEATABLE READ ì™€ ë™ì¼í•˜ì§€ë§Œ `SELECT` ì¿¼ë¦¬ê°€ ì „ë¶€ `SELECT ... FOR SHARE`ë¡œ ìë™ ë³€ê²½
     -> ëª¨ë“  select row ì— ëŒ€í•´ S Lock ì´ ê±¸ë¦¬ê³  X Lock (update, delete ë“± ë¶ˆê°€ëŠ¥)<br>
     -> S Lock ê±¸ë¦° row ì— update, delete ì‹œë„ ì‹œ deadlock
   - ë™ì‹œì„±ì´ ê°€ì¥ ë–¨ì–´ì§€ê³  ì‰½ê²Œ Dead Lock ì— ê±¸ë¦´ ìˆ˜ ìˆìŒ
   - ë§ì´ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ 

### ë ˆí¼ëŸ°ìŠ¤

[íŠ¸ëœì­ì…˜, íŠ¸ëœì­ì…˜ ê²©ë¦¬ìˆ˜ì¤€(Isolation Level)](https://feco.tistory.com/45)

[íŠ¸ëœì­ì…˜ ìˆ˜ì¤€ ì½ê¸° ì¼ê´€ì„±](http://wiki.gurubee.net/pages/viewpage.action?pageId=3900389)

[íŠ¸ëœì­ì…˜ì˜ ê²©ë¦¬ ìˆ˜ì¤€(isolation Level)ì´ë€?](https://nesoy.github.io/articles/2019-05/Database-Transaction-isolation)

[[MySQL] íŠ¸ëœì­ì…˜ì˜ ê²©ë¦¬ ìˆ˜ì¤€(isolation level)](https://deveric.tistory.com/85)

